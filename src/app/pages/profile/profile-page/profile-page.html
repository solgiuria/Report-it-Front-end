<!-- profile.page.html -->
<div class="profile-page">
  <div class="container">
    <h1>Mi Perfil</h1>

    @if (userData(); as user) {
      <!-- INFORMACI칍N DEL USUARIO -->
      <div class="profile-card">
        <div class="profile-header">
          <div class="avatar">
            {{ user.nombre.charAt(0) }}{{ user.apellido.charAt(0) }}
          </div>
          <div class="user-info">
            <h2>{{ user.nombre }} {{ user.apellido }}</h2>
            <p class="username">@{{ user.username }}</p>
          </div>
        </div>

        <div class="profile-details">
          <div class="detail-item">
            <span class="label">Email:</span>
            <span class="value">{{ user.email }}</span>
          </div>
          <div class="detail-item">
            <span class="label">DNI:</span>
            <span class="value">{{ user.dni }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Edad:</span>
            <span class="value">{{ user.edad }} a침os</span>
          </div>
        </div>
      </div>

      <!-- CAMBIAR CONTRASE칌A -->
      <div class="password-section">
        <button 
          class="btn-secondary" 
          (click)="togglePasswordForm()">
          {{ showPasswordForm() ? ' Cancelar' : ' Cambiar Contrase침a' }}
        </button>

        @if (showPasswordForm()) {
          <form [formGroup]="passwordForm" (ngSubmit)="handlePasswordChange()" class="password-form">
            
            <div class="form-group">
              <label for="contrasenaVieja">Contrase침a Actual *</label>
              <input 
                type="password" 
                id="contrasenaVieja"
                formControlName="contrasenaVieja"
                class="form-input"
              />
              @if (contrasenaVieja.hasError('required') && (contrasenaVieja.dirty || contrasenaVieja.touched)) {
                <span class="error-text">La contrase침a actual es obligatoria</span>
              }
            </div>

            <div class="form-group">
              <label for="contrasenaNueva">Contrase침a Nueva *</label>
              <input 
                type="password" 
                id="contrasenaNueva"
                formControlName="contrasenaNueva"
                class="form-input"
              />
              @if (contrasenaNueva.hasError('required') && (contrasenaNueva.dirty || contrasenaNueva.touched)) {
                <span class="error-text">La contrase침a nueva es obligatoria</span>
              }
              @if (contrasenaNueva.hasError('minlength') && (contrasenaNueva.dirty || contrasenaNueva.touched)) {
                <span class="error-text">M칤nimo 3 caracteres</span>
              }
              @if (contrasenaNueva.hasError('maxlength') && (contrasenaNueva.dirty || contrasenaNueva.touched)) {
                <span class="error-text">M치ximo 20 caracteres</span>
              }
            </div>

            <div class="form-group">
              <label for="confirmarContrasena">Confirmar Contrase침a Nueva *</label>
              <input 
                type="password" 
                id="confirmarContrasena"
                formControlName="confirmarContrasena"
                class="form-input"
              />
              @if (confirmarContrasena.hasError('required') && (confirmarContrasena.dirty || confirmarContrasena.touched)) {
                <span class="error-text">Debes confirmar la contrase침a</span>
              }
              @if (!passwordsMatch() && confirmarContrasena.dirty) {
                <span class="error-text">Las contrase침as no coinciden</span>
              }
            </div>

            <button 
              type="submit" 
              class="btn-primary"
              [disabled]="passwordForm.invalid || !passwordsMatch()">
              Cambiar Contrase침a
            </button>
          </form>
        }
      </div>

      <!-- CERRAR SESI칍N -->
      <div class="logout-section">
        <button class="btn-logout" (click)="logout()">
          游뛁 Cerrar Sesi칩n
        </button>
      </div>

    } @else {
      <p>Cargando perfil...</p>
    }
  </div>
</div>
